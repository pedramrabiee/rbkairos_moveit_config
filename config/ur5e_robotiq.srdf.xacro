<?xml version="1.0" encoding="UTF-8"?>
<!--
    Parameterized SRDF for UR5e + Robotiq 2F-85
    Supports separate arm_prefix, gripper_prefix, and base_prefix for Gazebo integration

    Usage:
      Standalone (no prefix): xacro ur5e_robotiq.srdf.xacro
      With Gazebo prefixes: xacro ur5e_robotiq.srdf.xacro arm_prefix:=rbkairos_arm_ gripper_prefix:=rbkairos_gripper_ base_prefix:=rbkairos_
-->
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="ur5e_robotiq">
    <xacro:arg name="arm_prefix" default=""/>
    <xacro:arg name="gripper_prefix" default="gripper_"/>
    <xacro:arg name="base_prefix" default=""/>
    <xacro:property name="arm_prefix" value="$(arg arm_prefix)"/>
    <xacro:property name="gripper_prefix" value="$(arg gripper_prefix)"/>
    <xacro:property name="base_prefix" value="$(arg base_prefix)"/>

    <!--GROUPS: Representation of a set of joints and links-->
    <!--For standalone: include virtual_joint (world->arm base)-->
    <!--For Gazebo: exclude virtual_joint (arm is connected to mobile base via fixed joints)-->
    <xacro:if value="${base_prefix == ''}">
        <group name="ur5e_arm">
            <joint name="virtual_joint"/>
            <joint name="${arm_prefix}shoulder_pan_joint"/>
            <joint name="${arm_prefix}shoulder_lift_joint"/>
            <joint name="${arm_prefix}elbow_joint"/>
            <joint name="${arm_prefix}wrist_1_joint"/>
            <joint name="${arm_prefix}wrist_2_joint"/>
            <joint name="${arm_prefix}wrist_3_joint"/>
        </group>
    </xacro:if>
    <xacro:if value="${base_prefix != ''}">
        <group name="ur5e_arm">
            <joint name="${arm_prefix}shoulder_pan_joint"/>
            <joint name="${arm_prefix}shoulder_lift_joint"/>
            <joint name="${arm_prefix}elbow_joint"/>
            <joint name="${arm_prefix}wrist_1_joint"/>
            <joint name="${arm_prefix}wrist_2_joint"/>
            <joint name="${arm_prefix}wrist_3_joint"/>
        </group>
    </xacro:if>
    <group name="gripper">
        <link name="${gripper_prefix}robotiq_85_base_link"/>
        <link name="${gripper_prefix}robotiq_85_left_knuckle_link"/>
        <link name="${gripper_prefix}robotiq_85_right_knuckle_link"/>
        <link name="${gripper_prefix}robotiq_85_left_finger_link"/>
        <link name="${gripper_prefix}robotiq_85_right_finger_link"/>
        <link name="${gripper_prefix}robotiq_85_left_inner_knuckle_link"/>
        <link name="${gripper_prefix}robotiq_85_right_inner_knuckle_link"/>
        <link name="${gripper_prefix}robotiq_85_left_finger_tip_link"/>
        <link name="${gripper_prefix}robotiq_85_right_finger_tip_link"/>
        <joint name="${gripper_prefix}robotiq_85_left_knuckle_joint"/>
    </group>

    <!--GROUP STATES: Named states for groups-->
    <group_state name="home" group="ur5e_arm">
        <joint name="${arm_prefix}shoulder_pan_joint" value="0"/>
        <joint name="${arm_prefix}shoulder_lift_joint" value="-1.5708"/>
        <joint name="${arm_prefix}elbow_joint" value="1.5708"/>
        <joint name="${arm_prefix}wrist_1_joint" value="-1.5708"/>
        <joint name="${arm_prefix}wrist_2_joint" value="-1.5708"/>
        <joint name="${arm_prefix}wrist_3_joint" value="0"/>
    </group_state>
    <group_state name="ready" group="ur5e_arm">
        <joint name="${arm_prefix}shoulder_pan_joint" value="0"/>
        <joint name="${arm_prefix}shoulder_lift_joint" value="-0.785"/>
        <joint name="${arm_prefix}elbow_joint" value="0"/>
        <joint name="${arm_prefix}wrist_1_joint" value="-2.356"/>
        <joint name="${arm_prefix}wrist_2_joint" value="0"/>
        <joint name="${arm_prefix}wrist_3_joint" value="0"/>
    </group_state>
    <group_state name="open" group="gripper">
        <joint name="${gripper_prefix}robotiq_85_left_knuckle_joint" value="0"/>
    </group_state>
    <group_state name="close" group="gripper">
        <joint name="${gripper_prefix}robotiq_85_left_knuckle_joint" value="0.7"/>
    </group_state>

    <!--END EFFECTOR-->
    <end_effector name="gripper" parent_link="${arm_prefix}tool0" group="gripper"/>

    <!--VIRTUAL JOINT: Connects map to robot base-->
    <!--For standalone: child_link is base_link (arm base), use world frame for fixed arm-->
    <!--For mobile robot: child_link is base_footprint (mobile base root), use map frame for navigation-->
    <xacro:if value="${base_prefix == ''}">
        <virtual_joint name="virtual_joint" type="fixed" parent_frame="world" child_link="${arm_prefix}base_link"/>
    </xacro:if>
    <xacro:if value="${base_prefix != ''}">
        <virtual_joint name="virtual_joint" type="planar" parent_frame="map" child_link="${base_prefix}base_footprint"/>
    </xacro:if>

    <!--DISABLE COLLISIONS: Arm links-->
    <disable_collisions link1="${arm_prefix}base_link" link2="${arm_prefix}base_link_inertia" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}base_link_inertia" link2="${arm_prefix}shoulder_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}base_link" link2="${arm_prefix}shoulder_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}shoulder_link" link2="${arm_prefix}upper_arm_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}upper_arm_link" link2="${arm_prefix}forearm_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}forearm_link" link2="${arm_prefix}wrist_1_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}wrist_1_link" link2="${arm_prefix}wrist_2_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}wrist_2_link" link2="${arm_prefix}wrist_3_link" reason="Adjacent"/>

    <!--Arm to gripper (standalone naming: gripper_ur_to_robotiq_link)-->
    <disable_collisions link1="${arm_prefix}wrist_3_link" link2="${gripper_prefix}ur_to_robotiq_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}ur_to_robotiq_link" link2="${gripper_prefix}robotiq_85_base_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}wrist_3_link" link2="${gripper_prefix}robotiq_85_base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}wrist_2_link" link2="${gripper_prefix}robotiq_85_base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}flange" link2="${gripper_prefix}ur_to_robotiq_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}flange" link2="${gripper_prefix}robotiq_85_base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}tool0" link2="${gripper_prefix}ur_to_robotiq_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}tool0" link2="${gripper_prefix}robotiq_85_base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}wrist_3_link" link2="${gripper_prefix}mount" reason="Never"/>
    <disable_collisions link1="${arm_prefix}flange" link2="${gripper_prefix}mount" reason="Never"/>
    <disable_collisions link1="${arm_prefix}tool0" link2="${gripper_prefix}mount" reason="Never"/>

    <!--Arm to gripper (Gazebo naming: rbkairos_gripper_adapter_ur_to_robotiq_link, rbkairos_gripper_base_link)-->
    <disable_collisions link1="${arm_prefix}wrist_3_link" link2="${gripper_prefix}adapter_ur_to_robotiq_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}adapter_ur_to_robotiq_link" link2="${gripper_prefix}robotiq_85_base_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}adapter_ur_to_robotiq_link" link2="${gripper_prefix}base_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}flange" link2="${gripper_prefix}adapter_ur_to_robotiq_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}tool0" link2="${gripper_prefix}adapter_ur_to_robotiq_link" reason="Adjacent"/>
    <disable_collisions link1="${arm_prefix}wrist_3_link" link2="${gripper_prefix}base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}wrist_2_link" link2="${gripper_prefix}base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}flange" link2="${gripper_prefix}base_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}tool0" link2="${gripper_prefix}base_link" reason="Never"/>
    <disable_collisions link1="${gripper_prefix}base_link" link2="${gripper_prefix}robotiq_85_base_link" reason="Adjacent"/>

    <!--Gripper internal-->
    <disable_collisions link1="${gripper_prefix}robotiq_85_base_link" link2="${gripper_prefix}robotiq_85_left_knuckle_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_base_link" link2="${gripper_prefix}robotiq_85_right_knuckle_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_base_link" link2="${gripper_prefix}robotiq_85_left_inner_knuckle_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_base_link" link2="${gripper_prefix}robotiq_85_right_inner_knuckle_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_knuckle_link" link2="${gripper_prefix}robotiq_85_left_finger_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_right_knuckle_link" link2="${gripper_prefix}robotiq_85_right_finger_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_finger_link" link2="${gripper_prefix}robotiq_85_left_finger_tip_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_right_finger_link" link2="${gripper_prefix}robotiq_85_right_finger_tip_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_inner_knuckle_link" link2="${gripper_prefix}robotiq_85_left_finger_tip_link" reason="Adjacent"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_right_inner_knuckle_link" link2="${gripper_prefix}robotiq_85_right_finger_tip_link" reason="Adjacent"/>

    <!--Non-adjacent arm links that never collide-->
    <disable_collisions link1="${arm_prefix}base_link" link2="${arm_prefix}upper_arm_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}base_link_inertia" link2="${arm_prefix}upper_arm_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}shoulder_link" link2="${arm_prefix}forearm_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}wrist_1_link" link2="${arm_prefix}wrist_3_link" reason="Never"/>
    <disable_collisions link1="${arm_prefix}wrist_2_link" link2="${gripper_prefix}ur_to_robotiq_link" reason="Never"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_knuckle_link" link2="${gripper_prefix}robotiq_85_right_knuckle_link" reason="Never"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_finger_link" link2="${gripper_prefix}robotiq_85_right_finger_link" reason="Never"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_finger_tip_link" link2="${gripper_prefix}robotiq_85_right_finger_tip_link" reason="Never"/>
    <disable_collisions link1="${gripper_prefix}robotiq_85_left_inner_knuckle_link" link2="${gripper_prefix}robotiq_85_right_inner_knuckle_link" reason="Never"/>

    <!--Mobile base to arm collisions (only active when base_prefix is set)-->
    <xacro:if value="${base_prefix != ''}">
        <!--Arm base to mobile base - these are mounted together-->
        <disable_collisions link1="${arm_prefix}base_link" link2="${base_prefix}base_link" reason="Adjacent"/>
        <disable_collisions link1="${arm_prefix}base_link" link2="${base_prefix}top_cover" reason="Adjacent"/>
        <disable_collisions link1="${arm_prefix}base_link_inertia" link2="${base_prefix}base_link" reason="Adjacent"/>
        <disable_collisions link1="${arm_prefix}base_link_inertia" link2="${base_prefix}top_cover" reason="Adjacent"/>
        <disable_collisions link1="${arm_prefix}shoulder_link" link2="${base_prefix}base_link" reason="Never"/>
        <disable_collisions link1="${arm_prefix}shoulder_link" link2="${base_prefix}top_cover" reason="Never"/>

        <!--Mobile base internal links-->
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}top_cover" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}base_footprint" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}front_left_wheel_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}front_right_wheel_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}back_left_wheel_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}back_right_wheel_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}top_cover" link2="${base_prefix}front_left_wheel_link" reason="Never"/>
        <disable_collisions link1="${base_prefix}top_cover" link2="${base_prefix}front_right_wheel_link" reason="Never"/>
        <disable_collisions link1="${base_prefix}top_cover" link2="${base_prefix}back_left_wheel_link" reason="Never"/>
        <disable_collisions link1="${base_prefix}top_cover" link2="${base_prefix}back_right_wheel_link" reason="Never"/>

        <!--Logo links (decorative, never collide)-->
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}base_logo_left" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}base_logo_right" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}base_logo_front" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}base_logo_rear" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}base_docking_contact" reason="Adjacent"/>

        <!--Sensor mounts-->
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}imu_base_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}imu_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}front_laser_base_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}front_laser_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}rear_laser_base_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}rear_laser_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}front_rgbd_camera_base_link" reason="Adjacent"/>
        <disable_collisions link1="${base_prefix}base_link" link2="${base_prefix}front_rgbd_camera_link" reason="Adjacent"/>
    </xacro:if>
</robot>
